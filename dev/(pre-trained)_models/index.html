<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>(Pre-Trained) Models · GradValley.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.png" alt="GradValley.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.png" alt="GradValley.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GradValley.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../gpu_support/">GPU Support</a></li><li><a class="tocitem" href="../reference/">Reference</a></li><li><a class="tocitem" href="../tutorials_and_examples/">Tutorials and Examples</a></li><li class="is-active"><a class="tocitem" href>(Pre-Trained) Models</a><ul class="internal"><li><a class="tocitem" href="#ResNet18/34/50/101/152-(Image-Classification)"><span>ResNet18/34/50/101/152 (Image Classification)</span></a></li></ul></li><li><a class="tocitem" href="../saving_and_loading/">Saving and Loading</a></li><li><a class="tocitem" href="../learning/">Learning</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>(Pre-Trained) Models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>(Pre-Trained) Models</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="(Pre-Trained)-Models"><a class="docs-heading-anchor" href="#(Pre-Trained)-Models">(Pre-Trained) Models</a><a id="(Pre-Trained)-Models-1"></a><a class="docs-heading-anchor-permalink" href="#(Pre-Trained)-Models" title="Permalink"></a></h1><h2 id="ResNet18/34/50/101/152-(Image-Classification)"><a class="docs-heading-anchor" href="#ResNet18/34/50/101/152-(Image-Classification)">ResNet18/34/50/101/152 (Image Classification)</a><a id="ResNet18/34/50/101/152-(Image-Classification)-1"></a><a class="docs-heading-anchor-permalink" href="#ResNet18/34/50/101/152-(Image-Classification)" title="Permalink"></a></h2><p>In the following table, the provided pre-trained ResNets are presented based on their key data (requires at least GradValley.jl v0.1.0). </p><table><tr><th style="text-align: right">Model</th><th style="text-align: right">Parameters</th><th style="text-align: right">Pre-Trained on ImageNet</th><th style="text-align: right">Accuracy on ImageNet-1K: Top-1/Top-5</th><th style="text-align: right">Categories</th><th style="text-align: right">File size</th><th style="text-align: right">Download</th></tr><tr><td style="text-align: right">ResNet18</td><td style="text-align: right">11,689,512</td><td style="text-align: right">✓</td><td style="text-align: right">~70%/~89%</td><td style="text-align: right">1000</td><td style="text-align: right">89 MB</td><td style="text-align: right"><a href="https://www.jst-projekte.de/downloads/resnets/ResNet18.zip">Here</a></td></tr><tr><td style="text-align: right">ResNet34</td><td style="text-align: right">21,797,672</td><td style="text-align: right">✓</td><td style="text-align: right">~73%/~91%</td><td style="text-align: right">1000</td><td style="text-align: right">166 MB</td><td style="text-align: right"><a href="https://www.jst-projekte.de/downloads/resnets/ResNet34.zip">Here</a></td></tr><tr><td style="text-align: right">ResNet50</td><td style="text-align: right">25,557,032</td><td style="text-align: right">✓</td><td style="text-align: right">~81%/~95%</td><td style="text-align: right">1000</td><td style="text-align: right">195 MB</td><td style="text-align: right"><a href="https://www.jst-projekte.de/downloads/resnets/ResNet50.zip">Here</a></td></tr><tr><td style="text-align: right">ResNet101</td><td style="text-align: right">44,549,160</td><td style="text-align: right">✓</td><td style="text-align: right">~82%/~96%</td><td style="text-align: right">1000</td><td style="text-align: right">340 MB</td><td style="text-align: right"><a href="https://www.jst-projekte.de/downloads/resnets/ResNet101.zip">Here</a></td></tr><tr><td style="text-align: right">ResNet152</td><td style="text-align: right">60,192,808</td><td style="text-align: right">✓</td><td style="text-align: right">~82%/~96%</td><td style="text-align: right">1000</td><td style="text-align: right">460 MB</td><td style="text-align: right"><a href="https://www.jst-projekte.de/downloads/resnets/ResNet152.zip">Here</a></td></tr></table><p><em>Currently, the files are hosted on my website. If you know a better place to host files which are too big for GitHub but are part of an open source julia package, please <a href="https://github.com/jonas208/GradValley.jl/discussions/categories/ideas">let me know</a>.</em></p><p>The downloaded folders each contain seven files:</p><pre><code class="nohighlight hljs">ResNetXX/
├── ResNet.jl
├── ResNetXX_pre-trained.jld2
├── categories_array.jld2
├── preprocessing_for_resnets.jl
├── load_ResNet_and_make_predictions.jl
├── example_image1.jpg
├── example_image2.jpg</code></pre><p>Where XX stands for the &quot;ResNet ID&quot; (18/34/50/101/152). For using this files, the follwing packages must be installed: <a href="https://github.com/jonas208/GradValley.jl">GradValley.jl</a>, <a href="https://github.com/JuliaIO/FileIO.jl">FileIO.jl</a>, <a href="https://github.com/JuliaImages/Images.jl">Images.jl</a> and <a href="https://github.com/JuliaImages/ImageTransformations.jl">ImageTransformations.jl</a>. The last two packages are used by <code>preprocessing_for_resnets.jl</code>.</p><ul><li><code>ResNet.jl</code>: The <a href="https://github.com/jonas208/GradValley.jl/blob/main/examples/ResNet.jl">source script</a> of the model definition, required for loading the <code>ResNetXX_pre-trained.jld2</code> file.</li><li><code>ResNetXX_pre-trained.jld2</code>: The pre-trained ResNet in form of a .jld2 file.</li><li><code>categories_array.jld2</code>: A vector containing the 1000 category names of ImageNet in the form of a .jld2 file.</li><li><code>preprocessing_for_resnets.jl</code>: A script with useful functions for loading and pre-processing images before they can be classified by the ResNets. </li><li><code>load_ResNet_and_make_predictions.jl</code>: A short script showing how to load the model and use it to make predictions.</li><li><code>example_image1.jpg</code>, <code>example_image2.jpg</code>: The example images used by <code>load_ResNets_make_prediction.jl</code>. The images don&#39;t come from the Image Net dataset or similar, instead, the two images are from my personal photo gallery on my phone.</li></ul><p>For example, the <code>load_ResNet_and_make_predictions.jl</code> script for ResNet18 looks like this (all scripts look exactly the same except the ResNet &quot;ID&quot; in the <code>model = load(&quot;ResNetXX_pre-trained.jld2&quot;, &quot;model&quot;)</code> line and the function which is called for pre-processing, in this case <code>preprocess_for_resnet18_and_34()</code>.): </p><pre><code class="language-julia hljs">include(&quot;ResNet.jl&quot;) # required for loading the ResNetXX_pre-trained.jld2 file
include(&quot;preprocessing_for_resnets.jl&quot;) # takes care of all the pre-processing of the images before they can be fed into the model
using FileIO # front-end package for loading e.g. JLD2 files 
using CUDA

model = load(&quot;ResNet18_pre-trained.jld2&quot;, &quot;model&quot;) # loads the pre-trained ResNet into the variable model (model is a SequentialContainer)
testmode!(model) # because we just want to make predictions, we switch the mode to testing/evaluation mode
categories = load(&quot;categories_array.jld2&quot;, &quot;categories_array&quot;) # categories is a vector containing all the 1000 classes of ImageNet-1k

# define the element type you want to use
dtype = Float32 # Float32 or Float64 (Float32 is usually faster, especially on the GPU!)
use_cuda = CUDA.functional() # check if a CUDA capable GPU is available
# move the loaded model to the correct element type and device
if use_cuda
    println(&quot;The GPU is used&quot;)
    module_to_eltype_device!(model, element_type=dtype, device=&quot;gpu&quot;)
else
    println(&quot;The CPU is used&quot;)
    module_to_eltype_device!(model, element_type=dtype, device=&quot;cpu&quot;)
end

# a function taking a path to an image file, returns the name of the predicted class and the score in percent
function make_prediciton(path::AbstractString)
    image = read_image_from_file(path) # reads the image into an UInt8 3d-array of size (width, height, channels) where channels must be 3
    image = preprocess_for_resnet18_and_34(image, dtype=dtype) # pre-processing when using ResNet18/34
    # image = preprocess_for_resnet50_and_101_and_152(image, dtype=dtype) # pre-processing when using ResNet50/101/152
    image = add_batch_dim(image) # add a batch dimension is required before the image can be fed into the model, image is now a 4d-array of size (width, height, channels, 1) where channels must be 3
    
    # if CUDA is available, move the image array to the GPU
    if use_cuda
        image = CuArray(image)
    end
    
    prediction = GradValley.Functional.softmax_forward(model(image), dims=1)[:, 1] # make the prediction (note that the first run can take a while because a lot of code has to get compiled at the first run)
    # prediction = model(image)[:, 1] # try without softmax if you get NaN values using softmax (if the images have been prepared well by the pre-processing, this should not happen)

    prediction = Array(prediction) # if a GPU is used, move the GPU array back to the CPU memory

    class_index = argmax(prediction)
    score = prediction[class_index] * 100
    class = categories[class_index]

    return class, score
end

for testimage in [&quot;example_image1.jpg&quot;, &quot;example_image2.jpg&quot;] # add more images here if you want 
    class, score = make_prediciton(testimage)
    println(&quot;&quot;&quot;Image: $testimage: Predicted class: &quot;$(class)&quot; with score of $(round(score, digits=1))%&quot;&quot;&quot;)
end</code></pre><p>It is heavily recommended to run this file, and any other files using GradValley, with multiple threads. Using multiple threads can make calculating predictions and training much faster. To do this, use the <code>-t</code> option when running a julia script in terminal/PowerShell/command line/etc. If your CPU has 24 threads, for example, then run: <code>julia -t 24 ./load_ResNet_and_make_predictions.jl</code> The specified number of threads should match the number of threads your CPU provides. When you run the script, you will get:</p><pre><code class="nohighlight hljs">Image: example_image1.jpg: Predicted class: &quot;castle&quot; with score of 99.2%
Image: example_image2.jpg: Predicted class: &quot;llama&quot; with score of 81.6%</code></pre><p><strong>We can see that both predicted classes are correct!</strong></p><p><strong>example_image1.jpg</strong> <img src="../assets/example_image1.jpg" alt="The first example image used by load_ResNets_make_prediction.jl"/> <strong>example_image2.jpg</strong> <img src="../assets/example_image2.jpg" alt="The second example image used by load_ResNets_make_prediction.jl"/></p><p>What&#39;s next? Maybe try changing the script to print out the top 5 categories and not just the top 1.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorials_and_examples/">« Tutorials and Examples</a><a class="docs-footer-nextpage" href="../saving_and_loading/">Saving and Loading »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 8 August 2023 21:56">Tuesday 8 August 2023</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
